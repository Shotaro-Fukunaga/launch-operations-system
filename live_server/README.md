# Live Streaming Server with NodeMediaServer

## 必要条件

- Node.js（バージョン10以降を推奨）

## 依存関係をインストール

以下のコマンドを実行して、必要な依存関係をインストールしてください：

```bash
npm i
```

## サーバーの起動方法

サーバーを起動するには、以下のコマンドを実行します：

```bash
node index.js
```  


## 設定の説明

ストリーミングサーバーの設定は、Node.jsスクリプト内の `config` オブジェクトで定義されています。以下は設定パラメータの詳細です。

### RTMP設定
- **port**: RTMPサーバーがリッスンするポート番号（デフォルト: 1935）
- **chunk_size**: RTMPのデータチャンクサイズ（バイト単位）。大きな値にすることでストリーミングの遅延を減少
- **gop_cache**: GOPキャッシュの有効/無効設定。キャッシュを無効にすることで遅延を最小化
- **ping**: クライアントへのピング間隔（秒）。接続の健全性を確認
- **ping_timeout**: ピング応答がない場合のタイムアウト設定（秒）

### HTTP設定
- **port**: HTTPベースのストリーミング（HLS）用のポート（デフォルト: 8010）
- **mediaroot**: ライブストリーミングファイルが保存されるディレクトリ
- **allow_origin**: CORSポリシー 全てのドメインからのアクセスを許可するために '*' に設定

### トランスコーディング設定
- **ffmpeg**: FFmpegのパス。インストールされたFFmpegの実行ファイルへのパスを指定
- **tasks**: トランスコーディングタスクのリスト。各タスクは以下のパラメータを持つ

#### トランスコーディングタスク
- **app**: アプリケーション名（ストリーミング識別子）
- **hls**: HLSでのストリーミングを有効にする（true/false）
- **rtmp**: RTMPでのストリーミングを有効にする（true/false）
- **dash**: DASH設定を有効/無効にする（true/false）
- **vc**: ビデオコーデック。例: "h264_nvenc" はNVIDIA GPUを使ったH264エンコーディング
- **ac**: オーディオコーデック。例: "copy" はオーディオを再エンコードせずにコピー
- **vcParams**: ビデオエンコーディングの追加パラメータ
  - `-preset`: エンコーディング速度と効率のプリセット（例: "ultrafast"）
  - `-tune`: 特定のエンコーディング最適化（例: "zerolatency"）
  - `-g`: GOP（Group of Pictures）の長さ
  - `-keyint_min`: 最小キーフレーム間隔
  - `-sc_threshold`: シーンチェンジ検出のしきい値
  - `-b:v`: ビデオビットレート
  - `-maxrate`: ビデオの最大ビットレート
  - `-bufsize`: バッファサイズ

- **acParams**: オーディオエンコーディングの追加パラメータ
  - `-b:a`: オーディオビットレート
  - `-ac`: オーディオのチャンネル数
  - `-ar`: オーディオのサンプルレート（Hz）

- **hlsFlags**: HLSの動作を制御するフラグ。例: '[hls_time=0.05:hls_list_size=3:hls_flags=delete_segments+append_list]'

### HLSストリーミングの詳細
- **hls_time**: 各HLSセグメントの時間（秒）。セグメント時間を短くすることで遅延を減少
- **hls_list_size**: プレイリスト内のセグメント数。プレイリスト内に保持するセグメントの数
- **hls_flags**: ストレージ管理のためのセグメント削除を含む、HLSの挙動を制御するフラグ


